    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>PEPPOL AS4 Endpoint Creation</title>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                margin: 0;
                background-color: #f2f2f2;
                -webkit-font-smoothing:antialiased;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
                background-color: white;
                padding: 20px;
                border-radius: 5px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                position: relative;
            }
            .header {
                display: flex;
                align-items: center;
                margin-bottom: 20px;
                padding-bottom: 10px;
                border-bottom: 1px solid #eee;
                background: linear-gradient(180deg,#4b3b36,#3b2f2c);
                color: #fff;
                padding: 14px 20px;
                border-radius: 0 0 4px 4px;
            }
            .header img {
                height: 40px;
                margin-right: 10px;
            }
            .breadcrumb {
                color: #2b6d8a;
                margin-bottom: 20px;
                font-weight: 600;
            }
            .form-group {
                margin-bottom: 15px;
            }
            label {
                display: block;
                margin-bottom: 5px;
                font-weight: 500;
            }
            input[type="text"], select, input[type="number"] {
                width: 100%;
                padding: 10px 12px;
                border: 1px solid #ddd;
                border-radius: 4px;
                box-sizing: border-box;
                font-size: 14px;
                background: #fff;
            }
            /* make required field show red outline like screenshots */
            input[required]:invalid, select[required]:invalid {
                box-shadow: none;
            }
            .input-required {
                border: 1px solid #e60000 !important;
            }
            .locked {
                background: #f5f5f5;
                color: #333;
            }
            .required::after {
                content: " *";
                color: red;
            }
            .button {
                background-color: #f0b36b;
                color: white;
                padding: 10px 18px;
                border: none;
                border-radius: 3px;
                cursor: pointer;
                font-weight: 600;
            }
            .button:hover {
                filter: brightness(.95);
            }
            .button.secondary {
                background: #6c757d;
            }
            .button.cancel {
                background: #e9ecef;
                color: #333;
                border: 1px solid #dcdcdc;
                font-weight: 600;
            }
            /* footer bar like screenshots */
            .footer-bar {
                margin-top: 30px;
                padding: 12px 16px;
                border-top: 1px solid #e6e6e6;
                display:flex;
                justify-content: flex-end;
                gap:10px;
                background: #fafafa;
            }
            .screen {
                display: none;
            }
            .active {
                display: block;
            }
            .tabs {
                display: flex;
                border-bottom: 1px solid #ddd;
                margin-bottom: 20px;
            }
            .tab {
                padding: 10px 20px;
                cursor: pointer;
                border: 1px solid transparent;
            }
            .tab.active {
                border: 1px solid #ddd;
                border-bottom: none;
                background: white;
                margin-bottom: -1px;
            }
            .tab-content {
                display: none;
            }
            .tab-content.active {
                display: block;
            }
            .error-message {
                color: red;
                margin-top: 5px;
                display: none;
            }
            .info-box {
                background-color: #f8f9fa;
                border: 1px solid #ddd;
                padding: 15px;
                margin: 10px 0;
                border-radius: 4px;
            }
            .loader {
                display:inline-block;
                width:16px;height:16px;border-radius:50%;
                border:2px solid #ddd;border-top-color:#f0b36b;
                animation:spin 1s linear infinite;vertical-align:middle;margin-left:8px;
            }
            @keyframes spin{to{transform:rotate(360deg)}}
            .form-actions {
                display:flex;
                gap:10px;
                margin-top:20px;
            }
            .top-right {
                position: absolute;
                right: 30px;
                top: 24px;
                font-size: 14px;
                color: #333;
            }
            .enabled-switch {
                display:inline-flex;
                align-items:center;
                gap:8px;
            }
            .enabled-switch input[type=checkbox] { width: 36px; height: 20px; }
            .checkbox-group {
                margin: 10px 0;
            }
            .checkbox-label {
                display: flex;
                align-items: center;
                margin: 5px 0;
            }
            .checkbox-label input[type="checkbox"] {
                margin-right: 10px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='50' font-size='50'>ðŸ”—</text></svg>" alt="Logo">
                <h1>Cleo Integration Cloud</h1>
            </div>
            
            <!-- Screen 1: Endpoint Type Selection -->
            <div id="screen1" class="screen active">
                <div class="breadcrumb">Network > Endpoints > New Endpoint</div>
                <div class="top-right">
                    <div class="enabled-switch">Enabled <input type="checkbox" id="enabledToggle" checked></div>
                </div>
                <div class="form-group">
                    <label class="required">Name</label>
                    <input type="text" id="endpointName" required>
                </div>
                <div class="form-group">
                    <label class="required">Type</label>
                    <select id="endpointType" required>
                        <option value="">Select</option>
                        <option>File System</option>
                        <option>Partner Mailbox</option>
                        <option>API</option>
                        <option>AS2</option>
                        <option>AzureBlob</option>
                        <option>Email</option>
                        <option>FTP(S)</option>
                        <option>GCS</option>
                        <option>OFTP(S)</option>
                        <option>S3</option>
                        <option>SFTP</option>
                        <option>RNIF</option>
                        <option value="PEPPOL">PEPPOL</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button class="button" onclick="nextScreen(1)">Next</button>
                    <button class="button cancel" onclick="cancel()">Cancel</button>
                </div>
            </div>

            <!-- Screen 2: PEPPOL ID Input -->
            <div id="screen2" class="screen">
                <div class="breadcrumb">Network > Endpoints > New Endpoint > PEPPOL ID</div>
                <div class="form-group">
                    <label class="required">PEPPOL ID</label>
                    <input type="text" id="peppolId" required>
                    <span id="lookupStatus" style="display:none">Looking up SMP<span class="loader"></span></span>
                    <div id="peppolIdError" class="error-message">Invalid PEPPOL ID</div>
                </div>
                <div class="form-actions">
                    <button class="button" onclick="validatePeppolId()">Next</button>
                    <button class="button secondary" onclick="previousScreen(2)">Back</button>
                    <button class="button cancel" onclick="cancel()">Cancel</button>
                </div>
            </div>

            <!-- Screen 3: Endpoint Configuration -->
            <div id="screen3" class="screen">
                <div class="breadcrumb">Network > Endpoints > New Endpoint > Configuration</div>
                
                                    <div class="form-group">
                                        <label>Trading Partner Name</label>
                                        <input type="text" id="configName">
                                </div>
                
                              
                <div class="form-group">
                    <label>PEPPOL ID</label>
                    <input type="text" id="configPeppolId" class="locked" disabled readonly>
                </div>

                <div class="form-group">
                    <label>URL</label>
                    <input type="text" value="https://as4.company.com/peppol/receive" disabled>
                </div>
                <div class="form-group">
                    <label>PEPPOL Participant Name</label>
                    <input type="text" value="PEPPOL TP1" disabled>
                </div>

                <div class="tabs">
                    <div class="tab active" data-tab="inbound">Inbound</div>
                    <div class="tab" data-tab="outbound">Outbound</div>
                    <div class="tab" data-tab="openPGP">OpenPGP</div>
                    <div class="tab" data-tab="advanced">Advanced</div>
                    <div class="tab" data-tab="docTypes">Transactions</div>
                </div>

                <div id="inbound" class="tab-content active">
                    
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" checked> Verify Signed Payloads
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" checked> Accept Encrypted Payloads
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" checked> Require HTTPS
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" checked> Use Default Filename
                        </label>
                    </div>
                </div>

                <div id="outbound" class="tab-content">

                    <div class="form-group">
                        <label class="required">SMP Lookup URL</label>
                        <input type="text" value="https://smp.peppol.eu" disabled>
                        <label class="required">Content Type</label>
                        <input type="text" value="XML" disabled>
                    </div>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" checked> Sign
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" checked> Encrypt
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" checked> Compress
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" checked> Request MDN Receipts
                        </label>
                    </div>
                </div>

                <div id="openPGP" class="tab-content">
                    <div class="form-group">
                        <label>Inbound</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" checked> Verify Signed Payloads
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" checked> Accept Encrypted Payloads
                            </label>
                        </div>

                        <label>Outbound</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" checked> Sign
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" checked> Encrypt
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" checked> Compress
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" checked> Text Output (ASCII armor)
                            </label>
                        </div>
                    </div>
                </div>

                <div id="advanced" class="tab-content">
                <div class="info-box">
                            > OpenPGP Algorithms<br>
                            > Security<br>
                            > Connection & Transfer<br>
                        </div>
                </div>

                <div id="docTypes" class="tab-content">
                    <div class="form-group">
                        <div class="info-box">
                            âœ“ PEPPOL BIS Billing 3.0<br>
                            âœ“ PEPPOL BIS Order 3.0<br>
                            âœ“ PEPPOL BIS Despatch Advice 3.0
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button class="button" onclick="saveEndpoint()">Save</button>
                    <button class="button secondary" onclick="previousScreen(3)">Back</button>
                    <button class="button cancel" onclick="cancel()">Cancel</button>
                </div>
            </div>
        </div>

        <script>
            let currentScreen = 1;

            function nextScreen(screen) {
                if (screen === 1) {
                    const nameEl = document.getElementById('endpointName');
                    const typeEl = document.getElementById('endpointType');
                    const name = nameEl.value.trim();
                    const type = typeEl.value;
                    
                    // visual required handling
                    if (!name) {
                        nameEl.classList.add('input-required');
                    } else {
                        nameEl.classList.remove('input-required');
                    }
                    if (!type) {
                        typeEl.classList.add('input-required');
                    } else {
                        typeEl.classList.remove('input-required');
                    }

                    if (!name || !type) {
                        return;
                    }

                    if (type !== 'PEPPOL') {
                        alert('This demo supports PEPPOL flow. Please select PEPPOL.');
                        return;
                    }
                    // default Trading Partner Name to endpoint name early
                    const cfgNameEl = document.getElementById('configName');
                    if (cfgNameEl) cfgNameEl.value = name;
                }

                document.getElementById(`screen${screen}`).classList.remove('active');
                document.getElementById(`screen${screen + 1}`).classList.add('active');
                currentScreen = screen + 1;
            }

            function previousScreen(screen) {
                document.getElementById(`screen${screen}`).classList.remove('active');
                document.getElementById(`screen${screen - 1}`).classList.add('active');
                currentScreen = screen - 1;
            }

            function validatePeppolId() {
                const peppolEl = document.getElementById('peppolId');
                const peppolId = peppolEl.value.trim();

                if (!peppolId) {
                    peppolEl.classList.add('input-required');
                    return;
                }
                peppolEl.classList.remove('input-required');

                // show loader/status
                const status = document.getElementById('lookupStatus');
                status.style.display = 'inline-block';
                document.getElementById('peppolIdError').style.display = 'none';

                // simulate async SMP lookup
                simulateSmpLookup(peppolId)
                    .then(smp => {
                        status.style.display = 'none';
                        // populate configuration fields using SMP response
                        const cfgNameEl = document.getElementById('configName');
                        const endNameEl = document.getElementById('endpointName');
                        if (cfgNameEl && endNameEl) cfgNameEl.value = endNameEl.value.trim();
                        const cfgPeppolEl = document.getElementById('configPeppolId');
                        if (cfgPeppolEl) {
                            cfgPeppolEl.value = peppolId;
                            // make the displayed PEPPOL ID read-only and visually locked
                            cfgPeppolEl.setAttribute('disabled', 'disabled');
                            cfgPeppolEl.setAttribute('readonly', 'readonly');
                            cfgPeppolEl.classList.add('locked');
                        }
                        // set SMP Lookup URL in Outbound tab input (make editable)
                        const smpInput = document.querySelector('#outbound input');
                        if (smpInput) {
                            smpInput.value = smp.smpUrl;
                            // keep SMP Lookup URL non-editable (remain disabled)
                            smpInput.setAttribute('disabled', 'disabled');
                        }
                        // populate supported document types into docTypes panel
                        const docBox = document.querySelector('#docTypes .info-box');
                        if (docBox) {
                            docBox.innerHTML = '';
                            smp.supportedDocs.forEach(d => {
                                docBox.innerHTML += 'âœ“ ' + d + '<br>';
                            });
                        }
                        // populate AS4 endpoint URL and partner name if inputs exist
                        const urlInput = document.querySelector('#screen3 input[type="text"]');
                        if (urlInput) {
                            // find the URL input (first text input in screen3 is URL)
                            urlInput.value = smp.as4Endpoint || urlInput.value;
                            urlInput.removeAttribute('disabled');
                        }
                        const partnerInput = Array.from(document.querySelectorAll('#screen3 input[type="text"]'))[1];
                        if (partnerInput) {
                            partnerInput.value = smp.participantId || partnerInput.value;
                            partnerInput.removeAttribute('disabled');
                        }

                        // navigate to screen 3
                        document.getElementById('screen2').classList.remove('active');
                        document.getElementById('screen3').classList.add('active');
                        currentScreen = 3;
                    })
                    .catch(err => {
                        status.style.display = 'none';
                        document.getElementById('peppolIdError').textContent = err.message || 'Invalid PEPPOL ID';
                        document.getElementById('peppolIdError').style.display = 'block';
                    });
            }

            // Simulate SMP lookup - returns a Promise that resolves with SMP metadata
            function simulateSmpLookup(peppolId) {
                return new Promise((resolve, reject) => {
                    // emulate network latency
                    setTimeout(() => {
                        if (!peppolId || peppolId === 'Fail') {
                            reject(new Error('SMP lookup failed: PEPPOL ID not found'));
                            return;
                        }

                        // fake SMP response
                        const smp = {
                            participantId: peppolId,
                            smpUrl: 'https://smp.peppol.example/' + encodeURIComponent(peppolId),
                            as4Endpoint: 'MyTP',
                            supportedDocs: [
                                'PEPPOL BIS Billing 3.0',
                                'PEPPOL BIS Order 3.0',
                                'PEPPOL BIS Despatch Advice 3.0'
                            ]
                        };
                        resolve(smp);
                    }, 1000 + Math.random()*800);
                });
            }

            function showTab(tabName, clickedEl) {
                // Hide all tab contents
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // Deactivate all tabs
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Show selected tab content
                document.getElementById(tabName).classList.add('active');
                
                // Activate clicked tab element if provided
                if (clickedEl) clickedEl.classList.add('active');
            }

            // wireup tab click handlers using data-tab attribute
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function(e){
                    const id = this.getAttribute('data-tab') || this.textContent.trim().toLowerCase();
                    showTab(id, this);
                });
            });

            function saveEndpoint() {
                const enabled = document.getElementById('enabledToggle').checked;
                const name = document.getElementById('configName').value || document.getElementById('endpointName').value;
                const peppolId = document.getElementById('configPeppolId').value;
                // simple verification
                if (!name || !peppolId) {
                    alert('Missing required configuration');
                    return;
                }

                // simulate save
                const endpoint = { name, peppolId, enabled };
                console.log('Saving endpoint', endpoint);
                alert('Endpoint "' + name + '" created successfully!');
                // Reset to first screen
                document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
                document.getElementById('screen1').classList.add('active');
                document.getElementById('endpointName').value = '';
                document.getElementById('endpointType').value = '';
                document.getElementById('peppolId').value = '';
                const cfgName = document.getElementById('configName'); if (cfgName) { cfgName.value = ''; cfgName.removeAttribute('disabled'); }
                const cfgPeppol = document.getElementById('configPeppolId'); if (cfgPeppol) { cfgPeppol.value = ''; cfgPeppol.removeAttribute('disabled'); cfgPeppol.removeAttribute('readonly'); cfgPeppol.classList.remove('locked'); }
                // keep SMP Lookup input disabled
                const smpInput = document.querySelector('#outbound input'); if (smpInput) smpInput.setAttribute('disabled','disabled');
                currentScreen = 1;
            }

            function cancel(){
                if (confirm('Cancel and discard changes?')){
                    // simple reset
                    document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
                    document.getElementById('screen1').classList.add('active');
                    document.getElementById('endpointName').value = '';
                    document.getElementById('endpointType').value = '';
                    document.getElementById('peppolId').value = '';
                    document.getElementById('configName').value = '';
                    document.getElementById('configPeppolId').value = '';
                    currentScreen = 1;
                }
            }
        </script>
    </body>
    </html>
