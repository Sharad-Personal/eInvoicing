<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PEPPOL Endpoints - List</title>
  <style>
    body{font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial; margin:0;background:#f4f4f4}
    .container{max-width:1100px;margin:32px auto;background:#fff;padding:18px;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.06)}
    h1{margin:0 0 14px;font-size:20px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 12px;border-bottom:1px solid #eee;text-align:left}
    th{background:#fafafa;color:#333;font-weight:600}
    a.endpoint-link{color:#0066cc;text-decoration:none}
    a.endpoint-link:hover{text-decoration:underline}
    .row-actions{display:flex;gap:8px}
    .button{background:#f0b36b;color:#fff;padding:8px 12px;border:none;border-radius:4px;cursor:pointer;font-weight:600}
    .button.secondary{background:#6c757d}
    .detail{display:none}
    .detail.active{display:block}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .small{font-size:13px;color:#666}
    .field{margin:8px 0}
    label{display:block;font-weight:600;margin-bottom:6px}
    input[type=text]{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px}
    .inline{display:inline-flex;gap:8px;align-items:center}
    .loader{display:inline-block;width:14px;height:14px;border-radius:50%;border:2px solid #ddd;border-top-color:#f0b36b;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .link-note{font-size:13px;color:#444;margin-top:10px}
  /* additional styles to match config screen */
  .breadcrumb{color:#2b6d8a;margin-bottom:12px;font-weight:600}
  .tabs{display:flex;border-bottom:1px solid #ddd;margin:12px 0}
  .tab{padding:8px 14px;cursor:pointer;border:1px solid transparent}
  .tab.active{border:1px solid #ddd;border-bottom:none;background:#fff;margin-bottom:-1px}
  .tab-content{display:none}
  .tab-content.active{display:block}
  .form-actions{display:flex;gap:10px;margin-top:12px}
  .info-box{background:#f8f9fa;border:1px solid #ddd;padding:12px;border-radius:4px}
  .checkbox-group{margin:8px 0}
  .checkbox-label{display:flex;align-items:center;margin:6px 0}
  .locked{background:#f5f5f5;color:#333}
  .button{background:#f0b36b;color:#fff;padding:8px 12px;border:none;border-radius:4px;cursor:pointer;font-weight:600}
  .button.secondary{background:#6c757d}
  .button.cancel{background:#e9ecef;color:#333;border:1px solid #dcdcdc}
  </style>
</head>
<body>
  <div class="container">
    <div id="listScreen">
      <div class="topbar">
        <h1>PEPPOL Endpoints</h1>
        <div class="small">Showing mock endpoints (click name to open the endpoint configuration)</div>
      </div>
      <table>
        <thead>
          <tr><th>Name</th><th>Created By</th><th>Modified</th></tr>
        </thead>
        <tbody id="endpointsTbody">
          <!-- rows populated by JS -->
        </tbody>
      </table>
      <div class="link-note">Endpoint config links open the existing `peppol-as4-endpoint.html` file (mock).</div>
    </div>

    <div id="detailScreen" class="detail">
      <div class="topbar">
        <h1 id="detailTitle">Endpoint</h1>
        <div>
          <button class="button secondary" onclick="backToList()">Back</button>
        </div>
      </div>

      <div class="field inline" style="align-items:center;gap:12px;margin-bottom:10px">
        <label style="margin-right:8px">Enabled</label>
        <input id="detailEnabled" type="checkbox">
        <button id="updateBtn" class="button" style="margin-left:8px">Update (SML)</button>
        <span id="updateLoader" style="display:none;margin-left:8px"><span class="loader"></span></span>
      </div>

      <div class="form-group">
        <label>Trading Partner Name</label>
        <input type="text" id="detailName">
      </div>

      <div class="form-group">
        <label>PEPPOL ID</label>
        <input type="text" id="detailPeppolId" class="locked" disabled readonly>
      </div>

      <div class="form-group">
        <label>URL</label>
        <input type="text" id="detailURL" value="https://as4.company.com/peppol/receive" readonly>
      </div>
      <div class="form-group">
        <label>PEPPOL Participant Name</label>
        <input type="text" id="detailParticipant" value="PEPPOL TP1" readonly>
      </div>

      <div class="tabs">
        <div class="tab active" data-tab="detailInbound">Inbound</div>
        <div class="tab" data-tab="detailOutbound">Outbound</div>
        <div class="tab" data-tab="detailOpenPGP">OpenPGP</div>
        <div class="tab" data-tab="detailAdvanced">Advanced</div>
        <div class="tab" data-tab="detailDocTypes">Transactions</div>
      </div>

      <div id="detailInbound" class="tab-content active">
        <div class="checkbox-group">
          <label class="checkbox-label"><input type="checkbox" checked> Verify Signed Payloads</label>
          <label class="checkbox-label"><input type="checkbox" checked> Accept Encrypted Payloads</label>
          <label class="checkbox-label"><input type="checkbox" checked> Require HTTPS</label>
        </div>
      </div>

      <div id="detailOutbound" class="tab-content">
        <div class="form-group">
          <label class="required">SMP Lookup URL</label>
          <input type="text" id="detailSmp" readonly>
          <label style="margin-top:8px">Content Type</label>
          <input type="text" id="detailContentType" value="XML" readonly>
        </div>
        <div class="checkbox-group">
          <label class="checkbox-label"><input type="checkbox" checked> Sign</label>
          <label class="checkbox-label"><input type="checkbox" checked> Encrypt</label>
        </div>
        <div class="form-group">
          <label>AS4 Endpoint / Party</label>
          <input type="text" id="detailAS4" readonly>
        </div>
      </div>

      <div id="detailOpenPGP" class="tab-content">
        <div class="form-group">
          <label>OpenPGP Settings</label>
          <div class="checkbox-group">
            <label class="checkbox-label"><input type="checkbox" checked> Verify Signed Payloads</label>
            <label class="checkbox-label"><input type="checkbox" checked> Accept Encrypted Payloads</label>
          </div>
        </div>
      </div>

      <div id="detailAdvanced" class="tab-content">
        <div class="info-box">Advanced settings (mock)</div>
      </div>

      <div id="detailDocTypes" class="tab-content">
        <div class="form-group">
          <div id="detailDocsBox" class="info-box">
            ✓ PEPPOL BIS Billing 3.0<br>✓ PEPPOL BIS Order 3.0
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button class="button" onclick="saveDetail()">Save</button>
        <button class="button secondary" onclick="backToList()">Back</button>
      </div>
    </div>
  </div>

  <script>
    const mockEndpoints = [
      {name:'Invoice-PEPPOL-01',peppol:'9908:ABC',createdBy:'alice',modified:'2025-09-01',smp:'https://smp.example/9908:ABC',tp:'TP-ABC',enabled:true},
      {name:'Invoice-PEPPOL-02',peppol:'9908:DEF',createdBy:'bob',modified:'2025-08-28',smp:'https://smp.example/9908:DEF',tp:'TP-DEF',enabled:false},
      {name:'Invoice-PEPPOL-03',peppol:'9908:GHI',createdBy:'carol',modified:'2025-07-12',smp:'https://smp.example/9908:GHI',tp:'TP-GHI',enabled:true}
    ];

    function renderList(){
      const tbody = document.getElementById('endpointsTbody');
      tbody.innerHTML='';
      mockEndpoints.forEach((e,idx)=>{
        const tr = document.createElement('tr');
        const nameTd = document.createElement('td');
        const a = document.createElement('a');
        a.href='peppol-as4-endpoint.html';
        a.textContent = e.name;
        a.className='endpoint-link';
        a.onclick = (ev)=>{ ev.preventDefault(); openDetail(idx); };
        nameTd.appendChild(a);
        const ctd = document.createElement('td'); ctd.textContent = e.createdBy;
        const mtd = document.createElement('td'); mtd.textContent = e.modified;
        tr.appendChild(nameTd); tr.appendChild(ctd); tr.appendChild(mtd);
        tbody.appendChild(tr);
      });
    }

    function openDetail(idx){
      const e = mockEndpoints[idx];
      document.getElementById('listScreen').style.display='none';
      const ds = document.getElementById('detailScreen'); ds.classList.add('active');
  document.getElementById('detailTitle').textContent = e.name + ' — Details';
  // name / trading partner
  const nameEl = document.getElementById('detailName'); if (nameEl) nameEl.value = e.name;
  // peppol id (read-only)
  const pid = document.getElementById('detailPeppolId'); if (pid) { pid.value = e.peppol; pid.setAttribute('disabled','disabled'); pid.setAttribute('readonly','readonly'); pid.classList.add('locked'); }
  // smp lookup url
  const smp = document.getElementById('detailSmp'); if (smp) { smp.value = e.smp || ''; }
  // AS4 / party
  const as4 = document.getElementById('detailAS4'); if (as4) as4.value = e.as4 || '';
  // participant name and URL
  const part = document.getElementById('detailParticipant'); if (part) part.value = e.participant || 'PEPPOL TP1';
  const url = document.getElementById('detailURL'); if (url) url.value = e.url || url.value;
  // supported docs
  const docsBox = document.getElementById('detailDocsBox'); if (docsBox) { docsBox.innerHTML = ''; (e.supportedDocs||['PEPPOL BIS Billing 3.0']).forEach(d=> docsBox.innerHTML += '✓ '+d+'<br>'); }
  document.getElementById('detailEnabled').checked = !!e.enabled;

      // store current index to window so update/save can modify
      window._currentIndex = idx;
    }

    function backToList(){
      document.getElementById('detailScreen').classList.remove('active');
      document.getElementById('listScreen').style.display='block';
    }

    // mock SML lookup - updates a few values by appending _updated
    function performSmlUpdate(){
      const idx = window._currentIndex;
      if (typeof idx !== 'number') return;
      const e = mockEndpoints[idx];
      document.getElementById('updateBtn').disabled = true;
      document.getElementById('updateLoader').style.display='inline-block';

      setTimeout(()=>{
  // simulate discovery/upsert from SML and populate fields
  e.name = e.name + '_updated';
  e.smp = (e.smp || '') + '_updated';
  e.tp = (e.tp || '') + '_updated';
  e.as4 = (e.as4 || 'MyTP') + '_updated';
  e.participant = (e.participant || 'PEPPOL TP1') + '_updated';
  e.supportedDocs = (e.supportedDocs || ['PEPPOL BIS Billing 3.0']).map(d=> d + '_updated');
  e.modified = new Date().toISOString().slice(0,10);
  // update UI fields in detail screen
  const nameEl = document.getElementById('detailName'); if (nameEl) nameEl.value = e.name;
  const smpEl = document.getElementById('detailSmp'); if (smpEl) smpEl.value = e.smp;
  const tpEl = document.getElementById('detailTP'); if (tpEl) tpEl.value = e.tp;
  const as4El = document.getElementById('detailAS4'); if (as4El) as4El.value = e.as4;
  const partEl = document.getElementById('detailParticipant'); if (partEl) partEl.value = e.participant;
  const docsBox = document.getElementById('detailDocsBox'); if (docsBox) { docsBox.innerHTML = ''; e.supportedDocs.forEach(d=> docsBox.innerHTML += '✓ '+d+'<br>'); }
  document.getElementById('updateBtn').disabled = false;
  document.getElementById('updateLoader').style.display='none';
  renderList();
      }, 1000 + Math.random()*800);
    }

    document.getElementById('updateBtn').addEventListener('click', performSmlUpdate);

    // simple tab wiring for detail tabs
    function showTab(tabName, clickedEl){
      document.querySelectorAll('.tab-content').forEach(c=> c.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(t=> t.classList.remove('active'));
      const el = document.getElementById(tabName);
      if (el) el.classList.add('active');
      if (clickedEl) clickedEl.classList.add('active');
    }
    document.querySelectorAll('.tab').forEach(tab=> tab.addEventListener('click', function(){ const id = this.getAttribute('data-tab'); showTab(id,this);}));

    function saveDetail(){
      const idx = window._currentIndex;
      if (typeof idx !== 'number') return alert('No endpoint selected');
      const e = mockEndpoints[idx];
      const nameEl = document.getElementById('detailName'); if (nameEl) e.name = nameEl.value;
      const tpEl = document.getElementById('detailTP'); if (tpEl) e.tp = tpEl.value;
      const enabledEl = document.getElementById('detailEnabled'); if (enabledEl) e.enabled = !!enabledEl.checked;
      e.as4 = (document.getElementById('detailAS4')||{}).value || e.as4;
      e.smp = (document.getElementById('detailSmp')||{}).value || e.smp;
      e.participant = (document.getElementById('detailParticipant')||{}).value || e.participant;
      e.modified = new Date().toISOString().slice(0,10);
      renderList();
      alert('Saved (mock)');
    }

    renderList();
  </script>
</body>
</html>
